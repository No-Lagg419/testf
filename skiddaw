-- üê≤ Pet Visual Scaler (Fixed Shape + Safe Scaling)
local Players = game:GetService("Players")
local player = Players.LocalPlayer

repeat task.wait() until player.Character and player:FindFirstChild("PlayerGui")

-- === CONFIG ===
local BASE_SCALE   = 1.0   -- Base size multiplier
local PER_KG_SCALE = 0.12  -- Scale increase per KG

-- Fixed proportions gaya ng screenshot mo (Mega Dragonfly style)
local FIXED_PROPORTIONS = Vector3.new(0.8, 2.0, 0.8) -- manipis X/Z, mahaba Y

-- Store original parts data para sa reset
local originalParts = {}

-- === GET EQUIPPED PET TOOL ===
local function getEquippedPet()
	for _, tool in ipairs(player.Character:GetChildren()) do
		if tool:IsA("Tool") then
			return tool
		end
	end
	return nil
end

-- === SAVE ORIGINAL STATE ===
local function saveOriginalState(model)
	originalParts = {}
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			originalParts[obj] = {Size = obj.Size}
		elseif obj:IsA("SpecialMesh") then
			originalParts[obj] = {Scale = obj.Scale}
		end
	end
end

-- === RESTORE ORIGINAL STATE ===
local function restoreOriginal(model)
	for obj, data in pairs(originalParts) do
		if obj and obj.Parent then
			if obj:IsA("BasePart") and data.Size then
				obj.Size = data.Size
			elseif obj:IsA("SpecialMesh") and data.Scale then
				obj.Scale = data.Scale
			end
		end
	end
end

-- === APPLY FIXED PROPORTIONS ===
local function applyFixedProportions(model)
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			obj.Size = Vector3.new(
				obj.Size.X * FIXED_PROPORTIONS.X,
				obj.Size.Y * FIXED_PROPORTIONS.Y,
				obj.Size.Z * FIXED_PROPORTIONS.Z
			)
		elseif obj:IsA("SpecialMesh") then
			obj.Scale = Vector3.new(
				obj.Scale.X * FIXED_PROPORTIONS.X,
				obj.Scale.Y * FIXED_PROPORTIONS.Y,
				obj.Scale.Z * FIXED_PROPORTIONS.Z
			)
		end
	end
end

-- === UNIFORM SCALE ===
local function scaleUniform(model, factor)
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			obj.Size = obj.Size * factor
		elseif obj:IsA("SpecialMesh") then
			obj.Scale = obj.Scale * factor
		end
	end
end

-- === MAIN SCALE FUNCTION ===
local function scalePetWithKG(tool, kg)
	restoreOriginal(tool) -- bumalik muna sa original shape
	applyFixedProportions(tool) -- apply Mega Dragonfly proportions
	local scaleFactor = BASE_SCALE + (kg * PER_KG_SCALE)
	scaleUniform(tool, scaleFactor) -- uniform scale para di masira
	print(string.format("‚úÖ Pet scaled to %.2fx (KG: %.2f)", scaleFactor, kg))
end

-- === GUI ===
local gui = Instance.new("ScreenGui")
gui.Name = "CustomKGPetScaler"
gui.ResetOnSpawn = false
gui.Parent = player.PlayerGui

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 220, 0, 160)
frame.Position = UDim2.new(1, -240, 0.4, 0)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "Pet Visual Scaler"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = Color3.fromRGB(255, 255, 255)

local input = Instance.new("TextBox", frame)
input.Size = UDim2.new(1, -20, 0, 30)
input.Position = UDim2.new(0, 10, 0, 40)
input.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
input.PlaceholderText = "Enter KG"
input.Text = ""
input.Font = Enum.Font.Gotham
input.TextSize = 14
input.TextColor3 = Color3.new(0, 0, 0)
Instance.new("UICorner", input).CornerRadius = UDim.new(0, 6)

local btnScale = Instance.new("TextButton", frame)
btnScale.Size = UDim2.new(1, -20, 0, 30)
btnScale.Position = UDim2.new(0, 10, 0, 80)
btnScale.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
btnScale.Text = "Scale Pet"
btnScale.Font = Enum.Font.GothamBold
btnScale.TextSize = 14
btnScale.TextColor3 = Color3.new(0, 0, 0)
Instance.new("UICorner", btnScale).CornerRadius = UDim.new(0, 6)

local btnReset = Instance.new("TextButton", frame)
btnReset.Size = UDim2.new(1, -20, 0, 30)
btnReset.Position = UDim2.new(0, 10, 0, 120)
btnReset.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
btnReset.Text = "Reset Pet"
btnReset.Font = Enum.Font.GothamBold
btnReset.TextSize = 14
btnReset.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", btnReset).CornerRadius = UDim.new(0, 6)

btnScale.MouseButton1Click:Connect(function()
	local pet = getEquippedPet()
	local kgValue = tonumber(input.Text)
	if pet and kgValue then
		if not next(originalParts) then
			saveOriginalState(pet)
		end
		scalePetWithKG(pet, kgValue)
	else
		warn("‚ö† Please equip a pet and enter a valid KG number.")
	end
end)

btnReset.MouseButton1Click:Connect(function()
	local pet = getEquippedPet()
	if pet and next(originalParts) then
		restoreOriginal(pet)
		print("üîÑ Pet reset to original size.")
	else
		warn("‚ö† No pet to reset or no saved original size.")
	end
end)
